Things to do before calling it done:

 - Preserve comments

 - Handle duplicates ('1 { some var } 2 { yadda yadda } 1 { some other var }').

